<!DOCTYPE html>
<html>
<head>
    <title>Dashboard Administrador</title>
</head>
<body>
    <h1>Dashboard Administrador</h1>
    <h2>Encuestas</h2>
    <ul id="encuestasList"></ul>
    <h2>Crear Nueva Encuesta</h2>
    <form id="nuevaEncuestaForm">
        <label for="titulo">Título:</label>
        <input type="text" name="titulo" id="titulo">
        <label for="num_preguntas">Número de Preguntas:</label>
        <input type="number" name="num_preguntas" id="num_preguntas">
        <div id="preguntas"></div>
        <button type="button" onclick="agregarPreguntas()">Agregar Preguntas</button>
        <button type="submit">Guardar</button>
    </form>
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <py-script>
        from js import document, fetch

        async def cargarEncuestas():
            response = await fetch('/admin', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({'password': 'admin'})
            })
            data = await response.json()
            encuestasList = document.getElementById('encuestasList')
            for encuesta in data['encuestas']:
                li = document.createElement('li')
                li.innerHTML = f"<a href='/admin/resultados/{data['encuestas'].index(encuesta)}'>{encuesta['titulo']}</a>"
                encuestasList.appendChild(li)

        async def nuevaEncuesta(event):
            event.preventDefault()
            titulo = document.getElementById('titulo').value
            num_preguntas = int(document.getElementById('num_preguntas').value)
            preguntas = [document.getElementById(f'pregunta_{i}').value for i in range(num_preguntas)]
            await fetch('/admin/nueva_encuesta', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({'titulo': titulo, 'preguntas': preguntas})
            })
            window.location.reload()

        def agregarPreguntas():
            numPreguntas = int(document.getElementById('num_preguntas').value)
            preguntasDiv = document.getElementById('preguntas')
            preguntasDiv.innerHTML = ''
            for i in range(numPreguntas):
                preguntasDiv.innerHTML += f"<label for='pregunta_{i}'>Pregunta {i + 1}:</label><input type='text' name='pregunta_{i}' id='pregunta_{i}'><br>"

        document.getElementById('nuevaEncuestaForm').addEventListener('submit', nuevaEncuesta)
        cargarEncuestas()
    </py-script>
</body>
</html>
